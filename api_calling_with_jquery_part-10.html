<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Api_calling_with_jquery_part-10_Fetch_API</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <!-- JQuery CDN -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- Jquery Cdn -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <!-- Loader section start-->
    <div class="d-flex justify-content-center myloader invisible">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    <!-- Loader section end -->
    <!-- Button section start -->
    <div class="d-flex justify-content-center">
      <button class="btn btn-success" data-a1="getdata">Get Data</button>
    </div>

    <!-- Button section end -->

    <!-- Table section start -->
    <table class="table mytable">
      <thead>
        <tr>
          <th scope="col">id</th>
          <th scope="col">idBook</th>
          <th scope="col">url</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <!-- Table section end -->

    <script>
      //var has a global scope
      var baseUrl = "https://fakerestapi.azurewebsites.net";
      //Loader section start
      var loader = document.querySelector(".myloader");
      document
        .querySelector('[data-a1="getdata"]')
        .addEventListener("click", function () {
          //loader.classList.remove(invisible);
          //Swal.fire("SweetAlert2 is working!");

          //Fetch api is a promise chain api
          //promiseobject.then().catch().finally();
          fetch(baseUrl + "/api/v1/CoverPhotos", {
            method: "GET",
          })
            .then((response) => response.json())
            .then((data) => {
              loader.classList.remove("invisible");
              console.log("success: ", data);
              console.log("success: ", typeof data);
              var tr = ``;
              data.forEach((element) => {
                console.log(element);
                tr =
                  tr +
                  `<tr>
                          <td scope="row">` +
                  element.id +
                  `</td>
                          <td>` +
                  element.idbook +
                  `</td>
                          <td><a target="_blank" href=" ` +
                  element.url +
                  `">Link</a> 

                  </td>

                      <td>
                        <button class="btn btn-success a_viewbtn">View</button>
                        <button class="btn btn-info a_editbtn">Edite</button>
                        <button class="btn btn-danger a_delbtn">Delete</button>

                      </td>
                          </tr>`;
              });
              //forEach ends here
              console.log(tr);
              document.querySelector("table.mytable > tbody").innerHTML = tr;
            })
            .catch((error) => {
              console.log(error);
            })
            .finally((all) => {
              console.log(all);
            });
        });
      /* function fetch2() {
        return new promise((resolve, reject) => {
          //resolve success
          //reject error
        });
      }
      fetch2().then().catch().finally(); */

      document.addEventListener("click", function (e) {
        //e event
        console.log(e.target.classList.contains("a _delbtn"));
        if (e.target.classList.contains("a_delbtn")) {
          let id = e.target.closest("tr").querySelector("td:first-child").innerHTML;
          fetch(baseUrl + "/api/v1/CoverPhotos/"+id, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              //console.log("Delete successfully");
              Swal.fire("Good job!", "You clicked the button", "success");
            })
            .catch()
            .finally();
          Swal.fire("Good job!", "Cover photo delete successfully", "success");
        }
      });
    </script>
  </body>
</html>
